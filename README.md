# 新闻发布会

模仿QQ新闻完成新闻后台发布和前台浏览。

 - 管理员对新闻分类管理，新建、编辑。
 
 - 实现不同的权限授权，若干个新闻编辑，可以在一个或几个分类中发布、编辑、删除新闻（日期、主题、内容、发布者）。
 
 - 实现新闻的搜索及搜索结果显示，在标题或在内容中模糊查找。
 
 - 普通用户浏览，注册用户登录、之后可浏览、收藏、发表评论。可以查看收藏和浏览历史。新闻的分类、分页显示。
 
 - 选做，新闻中可以包含图片。
 
 # 模仿　SQLalchemy 的小型ORM
 
 使用限制：
 
 首先必须满足单一主键
 java　模型的属性名和数据库的表名必须一致
 
 使用方法:
 
 首先需要建立一个模型类 User
 
 ```java
package model;

public class User {
    private int id = -1;  // 主键默认值必须为-1 这是由于hsqldb默认主键从0开始
    private String username;
    private String sex;
    private String user_identity;

    public void setId(int id) {
        this.id = id;
    }

    public void setUsername(String username) {
        this.username = username;
    }

    public void setSex(String sex) {
        this.sex = sex;
    }

    public void setUser_identity(String user_identity) {
        this.user_identity = user_identity;
    }

    public int getId() {
        return id;

    }

    public String getUsername() {
        return username;
    }

    public String getSex() {
        return sex;
    }

    public String getUser_identity() {
        return user_identity;
    }
}

```
 
 
 首先写一个自定义的类继承给定的虚基类
 
 ```java
package dao;

import model.User;
import java.util.Iterator;

public class UserDao extends Dao {

    protected static String table = "user";  // 数据库表名    
    
    protected static String class_type = User.class.getName(); // 数据模型的class

    public UserDao(){
        super(table, class_type);
    }

    public static void main(String [] args) throws Exception {
        UserDao dao = new UserDao();
        
        User user = new User();  // 创建模型对象 主键不需要设置　由ORM维护
        user.setSex("w");
        user.setUser_identity("editor");
        user.setUsername("sj");
        dao.add(user); // 存储到数据库
        
        /*
        * ORM的查询
        * 当前只支持单表查询
        * 支持单表的多条件查询
        */
        
        // 查找到id等于0的第一个对象
        User user1 = (User)dao.filter("id", "=0").first();
        System.out.println(user1.getUsername());
        
        
        // 在id大于-1的对象中查找用户名为 sj的对象
        User user2 = (User)dao.filter("id", ">-1").filter("username", "='sj'").first();
        System.out.println(user2.getUsername());
        
        
       //找到所有id大于-1的对象并输出用户名
        Iterator iter = dao.filter("id", ">-1").all();
                while (iter.hasNext()){
                    User u = (User)iter.next();
                    System.out.println(u.getUsername());
                }
                
       // 支持分页查询
       /*
        * 第一个参数为开始的行数　第二个为查询的个数
        */
       
       List<Object> list = dao.paginate(1, 10);
               for(Object o: list){
                   User u = (User)o;
                   System.out.println(u.getUsername());
               }
                
    }
}
```
输出结果:

```$xslt
insert into user ("USERNAME","SEX","USER_IDENTITY") values (?,?,?)
sj
sj
sj
```
 
# 数据库表
 
## 用户表

 主键ID  id 自增 唯一
 
 用户名称 username 不同
 
 用户性别 sex m or w
 
 用户身份 identity in (editor, user, administrator)
 
 ```sql
 create table user (
   ID INTEGER GENERATED BY DEFAULT AS IDENTITY,
   primary key (ID),
   USERNAME varchar(20) unique not null ,
   SEX varchar(20) not null ,
   Password varchar(20) default '123456' not null,
   USER_IDENTITY varchar(20) not null,
   check (sex in ('m' , 'w'))
 );
```

 
## 新闻类别表

主键ID id 自增　唯一

类型 非空　唯一

```sql
create table type(
  ID INTEGER GENERATED BY DEFAULT AS IDENTITY,
  primary key (ID),
  type varchar(20) default '默认' unique not null
);
```
 
## 新闻表

主键ID  id 自增　唯一

新闻标题 title 非空

新闻内容 content 非空

发布时间 time 时间

新闻类别 type 外键

发布者 publisher 外键　用户

浏览量　views 整型 

```sql
create table news(

  ID INTEGER GENERATED BY DEFAULT AS IDENTITY,

  primary key (ID),

  title varchar(30) not null ,

  content varchar(1000) not null ,

  datetime datetime default now(),

  news_type INTEGER not null ,

  publisher integer not null ,

  constraint news foreign key (publisher) references user(id) on delete cascade,

  foreign key (news_type) references type(id) on delete cascade,

  views integer default 0
);
```
 
## 收藏表

主键ID id 自增　唯一

收藏者 collector 外键　用户

收藏时间　time 时间

收藏文章 news 外键 新闻

```sql
create table collect (
  ID INTEGER GENERATED BY DEFAULT AS IDENTITY,
  primary key (ID),
  user_id integer not null ,
  datetime  datetime default now(),
  news_id integer not null ,
  constraint collect foreign key (user_id) references user(id) on delete cascade,
  foreign key (news_id) references NEWS(id) on delete cascade
);
```
 
## 评论表

主键ID id 自增　唯一

评论者 commentator 外键 用户

收藏时间　time 时间

被评论的文章 news 外键　新闻

```sql
create table comment(
  ID INTEGER GENERATED BY DEFAULT AS IDENTITY,
  primary key (ID),
  commentator integer not null ,
  datetime  datetime default now(),
  news integer not null ,
  constraint comment foreign key (commentator) references user(id) on delete cascade,
  foreign key (news) references NEWS(id) on delete cascade
);
```
  
## 浏览表

主键ID id 主键　唯一

浏览者 browser 外键　用户

收藏时间　time 时间

浏览内容 info 自定义

```sql
create table browser (
  ID INTEGER GENERATED BY DEFAULT AS IDENTITY,
  primary key (ID),
  browser integer not null,
  datetime  datetime default now(),
  info varchar(100) not null ,
  constraint browser foreign key (browser) references user(id) on delete cascade
);
```
